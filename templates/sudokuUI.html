<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Sudoku Reader</title>
    <style>
        table {
            border-collapse: collapse;
        }

        td {
            width: 30px;
            height: 30px;
            border: 1px solid black;
            text-align: center;
        }
    </style>
</head>

<body>
    <button id="generateSudokuButton">Generate Sudoku</button>
    <button id="solveSudokuBoard">Solve Board</button>
    <button id="checkSudokuBoard">Check Answers</button>
    <input type="text" id="userInputField">
    <button id="submitButton">Submit (x, y, num (1-9))</button>
    <div id="output"></div>
    <div id="output2"></div>
    <br />
    <p>notes:</p>
    <textarea name="notes" id="notes" style="height:100px; width:400px;"></textarea>

    <script>

        var globalTable;

        // Function to create and populate the table
        function createTable() {
            // Create the table element
            var outputDiv = document.getElementById('output');
            globalTable = document.createElement("table");
            globalTable.border = 1; // Changed from table.border to globalTable.border

            // Create and append table rows and cells
            for (var i = 0; i < 9; i++) {
                var row = document.createElement('tr');
                for (var j = 0; j < 9; j++) {
                    var cell = document.createElement('td');
                    row.appendChild(cell);
                }
                globalTable.appendChild(row);
            }
            outputDiv.appendChild(globalTable);
        }

        document.addEventListener("DOMContentLoaded", function () {
            createTable();
        });



        function displayData() {
            // Fetch the CSV file from the server
            fetch('/outfile.csv')
                .then(response => response.text())
                .then(content => {
                    const lines = content.split('\n');
                    const data = [];

                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim(); // Remove leading/trailing whitespaces
                        if (line === '') {
                            break; // Stop reading if an empty line is encountered
                        }
                        const parts = line.split(',');
                        data.push(parts);
                    }

                    // Display the Sudoku board
                    const outputDiv = document.getElementById('output');
                    outputDiv.innerHTML = '';

                    for (let i = 0; i < 9; i++) {
                        var row = globalTable.rows[i];
                        for (let j = 0; j < 9; j++) {
                            var cell = row.cells[j];
                            cell.textContent = data[i * 9 + j];

                        }
                    }
                    outputDiv.appendChild(globalTable);
                })
                .catch(error => console.error('Error fetching CSV file:', error));
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Function to handle button click event
            document.getElementById('generateSudokuButton').addEventListener('click', function () {
                // Request the server to generate a new Sudoku puzzle
                fetch('/generate_sudoku')
                    .then(response => {
                        // Once the Sudoku puzzle is generated, request the updated CSV file
                        if (response.ok) {
                            displayData();
                        } else {
                            console.error('Error generating Sudoku puzzle');
                        }
                    })
                    .catch(error => console.error('Error generating Sudoku puzzle:', error));
            });

            // Initial display of Sudoku board when the page loads
            displayData();
        });

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('solveSudokuBoard').addEventListener('click', function () {
                displaySolution();
            })

        });

        function displaySolution() {
            // Fetch the CSV file from the server
            fetch('/solution.csv')
                .then(response => response.text())
                .then(content => {
                    const lines = content.split('\n');
                    const data = [];

                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim(); // Remove leading/trailing whitespaces
                        if (line === '') {
                            break; // Stop reading if an empty line is encountered
                        }
                        const parts = line.split(',');
                        data.push(parts);
                    }

                    // Display the Sudoku board
                    const outputDiv = document.getElementById('output');
                    outputDiv.innerHTML = '';

                    for (let i = 0; i < 9; i++) {
                        var row = globalTable.rows[i];
                        for (let j = 0; j < 9; j++) {
                            var cell = row.cells[j];
                            cell.textContent = data[i * 9 + j];

                        }
                    }
                    outputDiv.appendChild(globalTable);
                })
                .catch(error => console.error('Error fetching CSV file:', error));
        }

        function checkBoard() {
            fetch('/solution.csv')
                .then(response => response.text())
                .then(content => {
                    const lines = content.split('\n');
                    const data = [];

                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim(); 
                        if (line === '') {
                            continue; 
                        }
                        const parts = line.split(',');
                        data.push(parts);
                    }

                    var outputDiv = document.getElementById("output2");
                    let mismatchFound = false;

                    // Check the board
                    for (let i = 0; i < 9; i++) {
                        var row = globalTable.rows[i];
                        for (let j = 0; j < 9; j++) {
                            var cell = row.cells[j];
                            var comparison = String(cell.textContent).localeCompare(data[i * 9 + j]);
                            if (comparison !== 0) {
                                mismatchFound = true;
                                break; 
                            }
                        }
                        if (mismatchFound) {
                            break; 
                        }
                    }

                    if (mismatchFound) {
                        winLoseMessage(false);
                    } else {
                        winLoseMessage(true);
                    }
                })
                .catch(error => console.error('Error fetching or parsing CSV file:', error));
        }


        function winLoseMessage(winOrLose) {
            var outputDiv = document.getElementById("output2");

            if (winOrLose == true) {
                outputDiv.innerHTML = "you did it!";
            } else {
                outputDiv.innerHTML = "try again!";
            }
            setTimeout(function () {
                outputDiv.innerHTML = "";
            }, 3000); 
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('checkSudokuBoard').addEventListener('click', function () {
                checkBoard();
            })

        });


        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('submitButton').addEventListener('click', function () {
                var userEdits = document.getElementById("userInputField").value;
                var x = userEdits.charCodeAt(0) - 49;
                var y = userEdits.charCodeAt(1) - 49;
                var num = userEdits.charCodeAt(2) - 48;
                var row = globalTable.rows[y];
                var cell = row.cells[x];
                cell.textContent = num;
            })

        });
</script>
</body>
</html>
